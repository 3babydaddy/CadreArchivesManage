<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tfkj.business.instructions.dao.InstructionsSupervisionDao">
  <resultMap id="BaseResultMap" type="com.tfkj.business.instructions.entity.InstructionsSupervision">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jan 16 11:32:45 GMT+08:00 2018.
    -->
    <id column="ID" jdbcType="VARCHAR" property="id" />
    <result column="IS_TRACK" jdbcType="VARCHAR" property="isTrack" />
    <result column="TRACK_TASK" jdbcType="VARCHAR" property="trackTask" />
    <result column="TRACK_SITUATION" jdbcType="VARCHAR" property="trackSituation" />
    <result column="STATUS" jdbcType="VARCHAR" property="status" />
    <result column="SALES_PERSON" jdbcType="VARCHAR" property="salesPerson" />
    <result column="IS_DAY_MANAGER" jdbcType="VARCHAR" property="isDayManager" />
    <result column="SALES_NUMBER_DATE" jdbcType="VARCHAR" property="salesNumberDate" />
    <result column="YEAR_NUMBER" jdbcType="VARCHAR" property="yearNumber" />
    <result column="TASK_TYPE" jdbcType="VARCHAR" property="taskType" />
    <result column="INSPECTION_DATE" jdbcType="VARCHAR" property="inspectionDate" />
    <result column="INSPECTION_TASK" jdbcType="VARCHAR" property="inspectionTask" />
    <result column="JOIN_COMPANY" jdbcType="VARCHAR" property="joinCompany" />
    <result column="LEAD_LEADER" jdbcType="VARCHAR" property="leadLeader" />
    <result column="INSPECTION_RANGE" jdbcType="VARCHAR" property="inspectionRange" />
    <result column="WORK_SITUATION" jdbcType="VARCHAR" property="workSituation" />
    <result column="INSPECTION_PROGRAMME" jdbcType="VARCHAR" property="inspectionProgramme" />
    <result column="INSPECTION_NOTICE" jdbcType="VARCHAR" property="inspectionNotice" />
    <result column="INSPECTION_SPECIAL_REPORT" jdbcType="VARCHAR" property="inspectionSpecialReport" />
    <result column="INSPECTION_INSTRUCTIONS" jdbcType="VARCHAR" property="inspectionInstructions" />

    <result column="OTHER_DATA" jdbcType="VARCHAR" property="otherData" />
    <result column="CREATE_BY" jdbcType="VARCHAR" property="createBy.id" />
    <result column="CREATE_DATE" jdbcType="VARCHAR" property="createDate" />
    <result column="UPDATE_BY" jdbcType="VARCHAR" property="updateBy.id" />
    <result column="UPDATE_DATE" jdbcType="VARCHAR" property="updateDate" />
    <result column="DEL_FLAG" jdbcType="VARCHAR" property="delFlag" />
      <result column="IS_RELATION" jdbcType="VARCHAR" property="isRelation" />
      <result column="RELATION_TASK" jdbcType="VARCHAR" property="relationTask" />

      <result column="LUOSHI_DATE" jdbcType="VARCHAR" property="luoshiDate" />
      <result column="XCTB_UPLOAD" jdbcType="VARCHAR" property="xctbUploadUrl" />
      <result column="LDPS_UPLOAD" jdbcType="VARCHAR" property="ldpsUploadUrl" />
      <result column="SCQD_UPLOAD" jdbcType="VARCHAR" property="scqdUploadUrl" />
      <result column="BGXS_UPLOAD" jdbcType="VARCHAR" property="bgxsUploadUrl" />
      <result column="BGXS" jdbcType="VARCHAR" property="bgxs" />
      <result column="INSPECTION_END_DATE" jdbcType="VARCHAR" property="inspectionEndDate" />
      <result column="SOURCE" jdbcType="VARCHAR" property="source" />
      <result column="relationTaskName" jdbcType="VARCHAR" property="relationTaskName" />

      <collection property="inspectionRangeList" ofType="com.tfkj.business.ywgl.entity.TableOfficeElement" >
          <id column="officeId" jdbcType="VARCHAR" property="id" />
          <result column="DATA_ID" jdbcType="VARCHAR" property="dataId" />
          <result column="OFFICE_ID" jdbcType="VARCHAR" property="office.id" />
          <result column="OFFICE_NAME" jdbcType="VARCHAR" property="office.name" />
          <result column="CHARGE_PERSON" jdbcType="VARCHAR" property="chargePerson" />
          <result column="FILE_PATH" jdbcType="VARCHAR" property="filePath" />
          <result column="officeSort" jdbcType="VARCHAR" property="sort" />
          <result column="CREATE_BY" jdbcType="VARCHAR" property="createBy.id" />
          <result column="CREATE_DATE" jdbcType="TIMESTAMP" property="createDate" />
          <result column="UPDATE_BY" jdbcType="VARCHAR" property="updateBy.id" />
          <result column="UPDATE_DATE" jdbcType="TIMESTAMP" property="updateDate" />
          <result column="REMARKS" jdbcType="VARCHAR" property="remarks" />
          <result column="DEL_FLAG" jdbcType="VARCHAR" property="delFlag" />
          <result column="A0001" jdbcType="VARCHAR" property="a0001" />
          <result column="A0002" jdbcType="TIMESTAMP" property="a0002" />
          <result column="A0003" jdbcType="VARCHAR" property="a0003" />
          <result column="A0004" jdbcType="VARCHAR" property="a0004" />
          <result column="A0005" jdbcType="VARCHAR" property="a0005" />
      </collection>
  </resultMap>
  <sql id="Base_Column_List">
    ID, IS_TRACK, TRACK_TASK, TRACK_SITUATION, STATUS,IS_DAY_MANAGER,SALES_PERSON,SALES_NUMBER_DATE,YEAR_NUMBER,TASK_TYPE,INSPECTION_DATE,INSPECTION_TASK,JOIN_COMPANY,LEAD_LEADER,INSPECTION_RANGE,WORK_SITUATION,INSPECTION_PROGRAMME,INSPECTION_NOTICE,INSPECTION_SPECIAL_REPORT,INSPECTION_INSTRUCTIONS,OTHER_DATA, CREATE_BY, CREATE_DATE, UPDATE_BY,
    UPDATE_DATE, DEL_FLAG,RELATION_TASK,IS_RELATION,
    LUOSHI_DATE,XCTB_UPLOAD,LDPS_UPLOAD,SCQD_UPLOAD,BGXS_UPLOAD,BGXS,INSPECTION_END_DATE,SOURCE
  </sql>
    <sql id="Base_Column_Office">
        office.ID as officeId , office.DATA_ID, office.OFFICE_ID, office.OFFICE_NAME, office.CHARGE_PERSON, office.FILE_PATH, office.SORT as officeSort, office.CREATE_BY, office.CREATE_DATE,
        office.UPDATE_BY, office.UPDATE_DATE, office.REMARKS, office.DEL_FLAG,office. A0001,office. A0002,office. A0003,office.A0004,office.A0005
    </sql>
    <select id="get" parameterType="java.lang.String" resultMap="BaseResultMap">

        select
        a.ID, IS_TRACK, TRACK_TASK, TRACK_SITUATION, STATUS,IS_DAY_MANAGER,SALES_PERSON,SALES_NUMBER_DATE,YEAR_NUMBER,TASK_TYPE,INSPECTION_DATE,INSPECTION_TASK,JOIN_COMPANY,LEAD_LEADER,INSPECTION_RANGE,WORK_SITUATION,INSPECTION_PROGRAMME,INSPECTION_NOTICE,INSPECTION_SPECIAL_REPORT,INSPECTION_INSTRUCTIONS,OTHER_DATA,RELATION_TASK,IS_RELATION,
        LUOSHI_DATE,XCTB_UPLOAD,LDPS_UPLOAD,SCQD_UPLOAD,BGXS_UPLOAD,BGXS,INSPECTION_END_DATE,SOURCE
        , (SELECT v.agreeMatterName FROM relation_view v WHERE v.id = a.RELATION_TASK  limit 0,1 ) as relationTaskName,

        <include refid="Base_Column_Office" />
        from instructions_supervision a
        left join ywgl_table_office_element office on a.id=office.DATA_ID
        where a.ID = #{id,jdbcType=VARCHAR} and a.DEL_FLAG='0'

    </select>

  <select id="findList" parameterType="com.tfkj.business.instructions.entity.InstructionsSupervision" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    ,(SELECT agreeMatterName FROM relation_view v WHERE v.id = RELATION_TASK  limit 0,1 ) as relationTaskName
    from instructions_supervision
    where DEL_FLAG = '0'
      <if test="id !=null and id != ''">
      AND  ID = #{id}
  </if>
      <if test="taskType !=null and taskType != ''">
          AND  TASK_TYPE = #{taskType}
      </if>
      <if test="yearNumber !=null and yearNumber != ''">
          AND  (INSPECTION_END_DATE LIKE CONCAT('%',#{yearNumber},'%')  OR INSPECTION_DATE LIKE CONCAT('%',#{yearNumber},'%')  )
      </if>
      <if test="joinCompany !=null and joinCompany != ''">
          AND (JOIN_COMPANY like CONCAT('%,',#{joinCompany},',%')
          or JOIN_COMPANY like CONCAT(#{joinCompany},',%')
          or JOIN_COMPANY like CONCAT('%,',#{joinCompany})
          or JOIN_COMPANY = #{joinCompany})
      </if>
      <if test="relationTaskName !=null and relationTaskName != ''">
          and RELATION_TASK IN (SELECT ID FROM relation_view WHERE agreeMatterName LIKE CONCAT('%', #{relationTaskName},'%') )
      </if>
      <if test="bgxs !=null and bgxs != ''">
          AND  BGXS LIKE CONCAT('%', #{bgxs},'%')
      </if>
      <if test="inspectionDate !=null and inspectionDate != ''">
          AND  STR_TO_DATE(INSPECTION_DATE,'%Y-%m-%d') &gt;= STR_TO_DATE(#{inspectionDate},'%Y-%m-%d')
      </if>
      <if test="inspectionEndDate !=null and inspectionEndDate != ''">
          AND STR_TO_DATE(INSPECTION_END_DATE,'%Y-%m-%d') &lt;= STR_TO_DATE(#{inspectionEndDate},'%Y-%m-%d')
      </if>
      <if test="leadLeader !=null and leadLeader != ''">
          AND  (LEAD_LEADER like CONCAT('%,',#{leadLeader},',%')
          or LEAD_LEADER like CONCAT(#{leadLeader},',%')
          or LEAD_LEADER like CONCAT('%,',#{leadLeader})
          or LEAD_LEADER = #{leadLeader})
      </if>
      <if test="inspectionTask !=null and inspectionTask != ''">
          AND  INSPECTION_TASK LIKE CONCAT('%',#{inspectionTask},'%')
      </if>
      <if test="inspectionRange !=null and inspectionRange != ''">
          AND  INSPECTION_RANGE LIKE CONCAT('%',#{inspectionRange},'%')
      </if>
      <if test="luoshiDate !=null and luoshiDate != ''">
          AND   STR_TO_DATE(LUOSHI_DATE,'%Y-%m-%d') &gt;= STR_TO_DATE(#{luoshiDate},'%Y-%m-%d')
      </if>
      <if test="luoshiEndDate !=null and luoshiEndDate != ''">
          AND  STR_TO_DATE(LUOSHI_DATE,'%Y-%m-%d') &lt;= STR_TO_DATE(#{luoshiEndDate},'%Y-%m-%d')
      </if>
      <if test="status !=null and status != ''">
          AND  STATUS = #{status}
      </if>
  </select>
    <select id="findRelationList" parameterType="com.tfkj.business.instructions.entity.InstructionsRelationPo" resultType="com.tfkj.business.instructions.entity.InstructionsRelationPo">
        select
        *
        from relation_view
        WHERE 1 = 1
        <if test="id !=null and id != ''">
             AND id != #{id}
        </if>
        <if test="findId !=null and findId != ''">
            AND id = #{findId}
        </if>
        <if test="taskYear !=null and taskYear != ''">
            AND (taskYear LIKE CONCAT('%',#{taskYear},'%')  OR  taskYearEnd LIKE CONCAT('%',#{taskYear},'%'))
        </if>
        <if test="agreeMatterName !=null and agreeMatterName != ''">
            AND (agreeMatterName LIKE CONCAT('%',#{agreeMatterName},'%') OR  name  LIKE CONCAT('%',#{agreeMatterName},'%'))
        </if>
        <if test="source !=null and source != ''">
            AND source = #{source}
        </if>

    </select>

    <select id="findMoreRelationList" parameterType="com.tfkj.business.instructions.entity.InstructionsRelationPo" resultType="com.tfkj.business.instructions.entity.InstructionsRelationPo">
        select
        id ,
        in0001 as agreeMatterName
        from  ywgl_instructions a
        WHERE
        a.DEL_FLAG = '0'
        <if test="id !=null and id != ''">
            AND id IN (${id})
        </if>

    </select>
  <delete id="delete" parameterType="com.tfkj.business.instructions.entity.InstructionsSupervision">
    UPDATE instructions_supervision SET instructions_supervision.DEL_FLAG = '1'
    where
    <choose>
      <when test="id != null and id !=''">
        ID = #{id}
      </when>
      <otherwise>
        1=2
      </otherwise>
    </choose>

  </delete>
  <insert id="insert" parameterType="com.tfkj.business.instructions.entity.InstructionsSupervision">
    insert into instructions_supervision (
       ID, IS_TRACK, TRACK_TASK, TRACK_SITUATION,
       STATUS,IS_DAY_MANAGER,SALES_PERSON,SALES_NUMBER_DATE,YEAR_NUMBER,TASK_TYPE,
       INSPECTION_DATE,INSPECTION_TASK,JOIN_COMPANY,LEAD_LEADER,INSPECTION_RANGE,WORK_SITUATION,
       INSPECTION_PROGRAMME,INSPECTION_NOTICE,INSPECTION_SPECIAL_REPORT,INSPECTION_INSTRUCTIONS,OTHER_DATA, CREATE_BY, CREATE_DATE, DEL_FLAG,RELATION_TASK,IS_RELATION,
    LUOSHI_DATE,XCTB_UPLOAD,LDPS_UPLOAD,SCQD_UPLOAD,BGXS_UPLOAD,BGXS,INSPECTION_END_DATE,SOURCE)
    values (#{id}, #{isTrack}, #{trackTask},#{trackSituation},
     #{status}, #{isDayManager},#{salesPerson},#{salesNumberDate}, #{yearNumber},#{taskType}, #{inspectionDate}, #{inspectionTask},#{joinCompany}, #{leadLeader}, #{inspectionRange},#{workSituation}, #{inspectionProgramme}, #{inspectionNotice},#{inspectionSpecialReport}, #{inspectionInstructions}, #{otherData}, #{createBy.id}, #{createDate,jdbcType=TIMESTAMP},'0',#{relationTask},#{isRelation}
      ,#{luoshiDate},#{xctbUploadUrl},#{ldpsUploadUrl},#{scqdUploadUrl},#{bgxsUploadUrl},#{bgxs},#{inspectionEndDate},#{source})
  </insert>

  <update id="update" parameterType="com.tfkj.business.instructions.entity.InstructionsSupervision">
    update instructions_supervision
  　<trim prefix="set"  suffixOverrides=",">
      <if test="isTrack != null">
        IS_TRACK = #{isTrack},
      </if>
      <if test="trackTask != null">
        TRACK_TASK = #{trackTask},
      </if>
      <if test="trackSituation != null">
        TRACK_SITUATION = #{trackSituation},
      </if>
      <if test="status != null">
        STATUS = #{status},
      </if>
      <if test="isDayManager != null">
        IS_DAY_MANAGER = #{isDayManager},
      </if>

      <if test="salesNumberDate != null">
        SALES_NUMBER_DATE = #{salesNumberDate},
      </if>
      <if test="yearNumber != null">
        YEAR_NUMBER = #{yearNumber},
      </if>
      <if test="taskType != null">
        TASK_TYPE = #{taskType},
      </if>
      <if test="inspectionDate != null">
        INSPECTION_DATE = #{inspectionDate},
      </if>

      <if test="updateBy.id != null">
        UPDATE_BY = #{updateBy.id,jdbcType=VARCHAR},
      </if>
      <if test="updateDate != null">
        UPDATE_DATE = #{updateDate,jdbcType=TIMESTAMP},
      </if>
      <if test="remarks != null">
        REMARKS = #{remarks,jdbcType=VARCHAR},
      </if>
      <if test="delFlag != null">
        DEL_FLAG = #{delFlag,jdbcType=VARCHAR},
      </if>

      <if test="inspectionTask != null">
        INSPECTION_TASK = #{inspectionTask},
      </if>
      <if test="joinCompany != null">
        JOIN_COMPANY = #{joinCompany},
      </if>
      <if test="leadLeader != null">
        LEAD_LEADER = #{leadLeader},
      </if>
      <if test="inspectionRange != null">
        INSPECTION_RANGE = #{inspectionRange},
      </if>
      <if test="workSituation != null">
        WORK_SITUATION = #{workSituation},
      </if>

      <if test="inspectionProgramme != null">
        INSPECTION_PROGRAMME = #{inspectionProgramme},
      </if>
      <if test="inspectionNotice != null">
        INSPECTION_NOTICE = #{inspectionNotice},
      </if>
      <if test="inspectionSpecialReport != null">
        INSPECTION_SPECIAL_REPORT = #{inspectionSpecialReport},
      </if>
      <if test="inspectionInstructions != null">
        INSPECTION_INSTRUCTIONS = #{inspectionInstructions},
      </if>
      <if test="otherData != null">
        OTHER_DATA = #{otherData},
      </if>
      <if test="relationTask != null">
          RELATION_TASK = #{relationTask},
      </if>
      <if test="isRelation != null">
          IS_RELATION = #{isRelation},
      </if>



      <if test="luoshiDate != null">
          LUOSHI_DATE = #{luoshiDate},
      </if>
      <if test="xctbUploadUrl != null">
          XCTB_UPLOAD = #{xctbUploadUrl},
      </if>
      <if test="ldpsUploadUrl != null">
          LDPS_UPLOAD = #{ldpsUploadUrl},
      </if>
      <if test="scqdUploadUrl != null">
          SCQD_UPLOAD = #{scqdUploadUrl},
      </if>
      <if test="bgxsUploadUrl != null">
          BGXS_UPLOAD = #{bgxsUploadUrl},
      </if>
      <if test="bgxs != null">
          BGXS = #{bgxs},
      </if>
      <if test="inspectionEndDate != null">
          INSPECTION_END_DATE = #{inspectionEndDate},
      </if>
      <if test="source != null">
          SOURCE = #{source},
      </if>
  </trim>
    where ID = #{id}
  </update>
    <update id="updateInspection" parameterType="com.tfkj.business.instructions.entity.InstructionsSupervision">
        update instructions_supervision
    　<trim prefix="set"  suffixOverrides=",">
        <if test="isTrack != null">
            IS_TRACK = #{isTrack},
        </if>
        <if test="trackTask != null">
            TRACK_TASK = #{trackTask},
        </if>
        <if test="trackSituation != null">
            TRACK_SITUATION = #{trackSituation},
        </if>
        <if test="status != null">
            STATUS = #{status},
        </if>
        <if test="isDayManager != null">
            IS_DAY_MANAGER = #{isDayManager},
        </if>

        <if test="salesNumberDate != null">
            SALES_NUMBER_DATE = #{salesNumberDate},
        </if>
        <if test="yearNumber != null">
            YEAR_NUMBER = #{yearNumber},
        </if>
        <if test="taskType != null">
            TASK_TYPE = #{taskType},
        </if>
        <if test="inspectionDate != null">
            INSPECTION_DATE = #{inspectionDate},
        </if>
        <if test="updateDate != null">
            UPDATE_DATE = getdate(),
        </if>
        <if test="remarks != null">
            REMARKS = #{remarks,jdbcType=VARCHAR},
        </if>
        <if test="delFlag != null">
            DEL_FLAG = #{delFlag,jdbcType=VARCHAR},
        </if>

        <if test="inspectionTask != null">
            INSPECTION_TASK = #{inspectionTask},
        </if>
        <if test="joinCompany != null">
            JOIN_COMPANY = #{joinCompany},
        </if>
        <if test="leadLeader != null">
            LEAD_LEADER = #{leadLeader},
        </if>
        <if test="inspectionRange != null">
            INSPECTION_RANGE = #{inspectionRange},
        </if>
        <if test="workSituation != null">
            WORK_SITUATION = #{workSituation},
        </if>

        <if test="inspectionProgramme != null">
            INSPECTION_PROGRAMME = #{inspectionProgramme},
        </if>
        <if test="inspectionNotice != null">
            INSPECTION_NOTICE = #{inspectionNotice},
        </if>
        <if test="inspectionSpecialReport != null">
            INSPECTION_SPECIAL_REPORT = #{inspectionSpecialReport},
        </if>
        <if test="inspectionInstructions != null">
            INSPECTION_INSTRUCTIONS = #{inspectionInstructions},
        </if>
        <if test="otherData != null">
            OTHER_DATA = #{otherData},
        </if>
        <if test="relationTask != null">
            RELATION_TASK = #{relationTask},
        </if>
        <if test="isRelation != null">
            IS_RELATION = #{isRelation},
        </if>
        <if test="luoshiDate != null">
            LUOSHI_DATE = #{luoshiDate},
        </if>
        <if test="xctbUploadUrl != null">
            XCTB_UPLOAD = #{xctbUploadUrl},
        </if>
        <if test="ldpsUploadUrl != null">
            LDPS_UPLOAD = #{ldpsUploadUrl},
        </if>
        <if test="scqdUploadUrl != null">
            SCQD_UPLOAD = #{scqdUploadUrl},
        </if>
        <if test="bgxsUploadUrl != null">
            BGXS_UPLOAD = #{bgxsUploadUrl},
        </if>
        <if test="bgxs != null">
            BGXS = #{bgxs},
        </if>
        <if test="inspectionEndDate != null">
            INSEPECTION_END_DATE = #{inspectionEndDate},
        </if>
        <if test="source != null">
            SOURCE = #{source},
        </if>
    </trim>
        where ID = #{id}
    </update>
</mapper>